<!DOCTYPE html>
<html>
<head>
	<title>OpenSSL OCSP 状态请求扩展内存耗尽 (CVE-2016-6304)</title>
	<meta http-equiv="Content-type" content="text/html; charset=UTF-8">
	<link rel="stylesheet" href="common.css" type="text/css">
	<link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon">
	<div id='wx_pic' style='margin:0 auto;display:none;'>
	<img src='logo-300.png' />
	</div>
</head>
<body>
    <div class="content">
		<p>
		    <a href="http://www.360.com/">
		        <img src="logo01.png" alt="logo" class="site_logo">
		    </a>
		</p>
		<p><a href="index.html">[English]</a></p>
		<p>最后更新: 2016年9月22日，18:55:00 星期四 +0800</p>
		<h1 id="ccs-injection-vulnerability">OpenSSL OCSP 状态请求扩展内存耗尽 (CVE-2016-6304)</h1>
		<h2 id="overview">概述</h2>

		<p><img src="logo.png" alt="CCS-Injection logo" class="logo"></p>

		<p>OpenSSL OCSP 状态请求扩展存在严重漏洞，该漏洞令恶意客户端能耗尽服务器内存。利用该漏洞，能使默认配置的服务器在每次协议重商时分配一段 OCSP ids 内存，
不断重复协商可令服务器内存无限消耗，即使服务器并未配置 OCSP。理论上，一个 OCSP 
id 最多 65,535 字节，攻击者可以不断重商令服务器每次内存消耗近 64K。但从实现来说，在 OpenSSL 1.0.2 版本中对 
ClientHello 长度做了 16,384 字节的限制，因此每次重商只能令服务器内存消耗约 16K。但在最新的 1.1.0 版本中，对 
ClientHello 长度的限制增加到 131,396 字节，那么对使用 1.1.0 版本的服务器，每次重商会令内存消耗近 64K。
</p>
		<h2 id="countermeasures">对策</h2>
		<p>从供应商获得软件更新。参考下面链接。</p>

		<ul>
		    <li><a href="https://security-tracker.debian.org/tracker/CVE-2016-6304" title="Debian">Debian</a></li>
		    <li><a href="https://access.redhat.com/security/cve/CVE-2016-6304" title="Redhat/CentOS">Redhat/CentOS</a></li>
    <!-- 
	            <li><a href="" title="Ubuntu">Ubuntu</a></li>
		    <li><a href="https://www.freebsd.org/security/advisories/FreeBSD-SA-14:14.openssl.asc" title="FreeBSD">FreeBSD</a></li>
		    <li><a href="https://aws.amazon.com/jp/security/security-bulletins/openssl-security-advisory/" title="Amazon Linux AMI">Amazon Linux AMI</a></li> 
    !-->
		</ul>
		<h2 id="problem">问题</h2>

		<p>A. 攻击者可通过发送大量 OCSP 状态请求扩展导致服务器拒绝服务。</p>

		<h2 id="q-how-does-the-vulnerability-work">Q. 如何利用？</h2>

		<p>A. 攻击者使用 TLS 扩展 "TLSEXT_TYPE_status_request"，填充 OCSP ids 并不断请求重商。 </p>

		<h2 id="q-what-versions-of-openssl-are-affected">Q. 哪些版本受影响？</h2>

		<p>A. 影响版本：</p>

		<ul>
			<li>OpenSSL 0.9.8h through 0.9.8v</li>
			<li>OpenSSL 1.0.1 through 1.0.1t</li>
			<li>OpenSSL 1.0.2 through 1.0.1h</li>
			<li>OpenSSL 1.1.0</li>
		</ul>

		<p>不受影响：</p>

		<ul>
			<li>OpenSSL 1.0.1u</li>
		    <li>OpenSSL 1.0.2i</li>
		    <li>OpenSSL 1.1.0a</li>
		</ul>


		<h2 id="q-what-are-the-risks">Q. 有何危害？</h2>
		<p>A. 攻击者可通过不断重商，发送大量 OCSP 状态请求扩展，导致服务器内存无限增长，最终导致服务器拒绝服务。默认OpenSSL配置的服务器会受影响，即使其并不支持 OCSP，除非在编译时使用了“no-ocsp”编译选项。  </p>
	

		<h2 id="q-how-can-i-prevent-the-attacks">Q. 如何避免被攻击？</h2>

		<p>A. 升级到最新版本。</p>

		<h2 id="q-how-widespread-is-this">Q. 漏洞利用影响范围？</h2>

		<p>A. 我们只测试了小部分使用OpenSSL OCSP功能的组件，包括OpenSSL Server、Nginx、和Apache。其中默认配置的 OpenSSL server 是受影响的(包括:OpenSSL 0.9.8h through 0.9.8v、OpenSSL 1.0.1 through 1.0.1t、OpenSSL 1.0.2 through 1.0.1h、OpenSSL 1.1.0)。
        Nginx 0.8.23 以前的版本会受此影响，Apache 2.0以前及 SSLInsecureRenegotiation 配置项为 on 是都会受此影响。
        </p>

		<h2 id="q-do-i-have-to-re-create-my-private-keys-or-certificates">Q. 我需要注销私钥或证书吗？</h2>
		<p>A. 不需要。攻击者不能窃取到私钥。 </p>

		<h2 id="q-is-ccs-injection-because-of-an-ssltls-specification-defect">Q. 是由于 SSL/TLS 规范缺陷造成的吗？</h2>
		<p>A. 不是。这是 OpenSSL 实现问题。</p>

		<h2 id="q-what-protocol-versions-are-affected">Q. 哪些协议版本受影响？</h2>
		<p>A. 所有版本 (SSL3.0, TLS1.0, TLS1.1, TLS1.2) 都受影响。</p>

		<h2 id="q-what-encryption-algorithms-are-affected">Q. 哪些加密算法受影响？</h2>
		<p>A. 所有加密算法都受影响（此问题与算法无关）。 </p>

		<h2 id="q-can-i-detect-if-someone-has-exploited-this-against-me">Q. 如何发现被攻击了？</h2>
		<p>A. 很难说。也许可以试试看分析崩溃信息。</p>

		<h2 id="q-how-did-you-find-this-bug">Q. 你们怎么发现这个漏洞的？</h2>
		<p>A. 此漏洞由来自360Gear Team的 石磊 (360信息安全部)在阅读 OpenSSL 源码时发现。</p>

		<h2 id="q-how-do-you-report-this-vulnerability">Q. 你们是如何处理此漏洞的？</h2>

		<p>A. 我们发现漏洞后报给了 OpenSSL 官方。</p>

		<h2 id="references">参考</h2>

		<ul>
		  	<li><a href="https://www.openssl.org/news/secadv/20160922.txt">OpenSSL</a></li>
		  	<li><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6304">CVE-2016-6304</a></li>
            <!--
		  	<li><a href="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2016-6304">NIST</a></li>
		  	<li><a href="http://www.kb.cert.org/vuls/id/978508">CERT/CC (USA)</a></li>
            -->
		</ul>

		<p>可以在<a href="http://creativecommons.org/publicdomain/zero/1.0/">CC0</a>协议下使用此图标。<a href="logo.svg">下载SVG格式图标</a></p>

		<h2 id="Acknowledgements">致谢</h2>
		<ul>
			<li>感谢 <a href="http://ccsinjection.lepidum.co.jp/">CCS Injection</a> 团队的模板。</li>
			<li>感谢 360信息安全部、NetOPS、Hulk、Qiyun 团队的支持。</li>
		</ul>

		<h2 id="change-history">修改记录</h2>
		<ul>
		  	<li>第一版: (2016年9月22日，16:55:00 星期四 +0800)</li>
		</ul>

	</div>
	<footer>
		<div class="copyright">
		    <p style="float: left;"> Qihoo 360 Co. Ltd.
		  		<span style="margin-left: 10px">联系方式： <a href="mailto:g-cloud-sec@360.cn">g-cloud-sec@360.cn</a></span><br>Copyright © 2016 Qihoo 360 Co. Ltd. All rights reserved.
		    </p>
		    <div style="float: right;"><img src="logo01.png" class="site_logo"></a></div>
		</div>
	</footer>
</body>
</html>
